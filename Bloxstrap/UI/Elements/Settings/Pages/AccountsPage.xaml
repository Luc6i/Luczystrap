<ui:UiPage x:Class="Bloxstrap.UI.Elements.Settings.Pages.AccountsPage"
      x:Name="AccountsPageView"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
      xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
      xmlns:ui="http://schemas.lepo.co/wpfui/2022/xaml"
      xmlns:controls="clr-namespace:Bloxstrap.UI.Elements.Controls"
      xmlns:resources="clr-namespace:Bloxstrap.Resources"
      mc:Ignorable="d"
      d:DesignHeight="1080" d:DesignWidth="800"
      Title="AccountsPage"
      Scrollable="True">
    <StackPanel Margin="0,0,14,14">
        <TextBlock Text="Manage multiple Roblox accounts and switch between them easily. Add accounts by entering their security cookie." 
                   FontSize="14" 
                   Foreground="{DynamicResource TextFillColorSecondaryBrush}" 
                   TextWrapping="Wrap" />

        <TextBlock Text="Saved Accounts" FontSize="20" FontWeight="Medium" Margin="0,16,0,8" />

        <!-- Account List -->
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto" />
                <RowDefinition Height="*" MinHeight="300" />
                <RowDefinition Height="Auto" />
            </Grid.RowDefinitions>

            <!-- No accounts message -->
            <Border Grid.Row="1" 
                    BorderThickness="1" 
                    BorderBrush="{DynamicResource ControlElevationBorderBrush}"
                    Background="{DynamicResource ControlFillColorDefaultBrush}"
                    CornerRadius="4"
                    Padding="20"
                    Visibility="{Binding HasNoAccounts, Converter={StaticResource BoolToVisibilityConverter}}">
                <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center">
                    <ui:SymbolIcon Symbol="PersonAccounts24" FontSize="48" Foreground="{DynamicResource TextFillColorSecondaryBrush}" />
                    <TextBlock Text="No accounts added yet" 
                               FontSize="16" 
                               FontWeight="Medium"
                               Margin="0,12,0,4"
                               HorizontalAlignment="Center"
                               Foreground="{DynamicResource TextFillColorPrimaryBrush}" />
                    <TextBlock Text="Click 'Add Account' to get started" 
                               FontSize="14" 
                               HorizontalAlignment="Center"
                               Foreground="{DynamicResource TextFillColorSecondaryBrush}" />
                </StackPanel>
            </Border>

            <!-- Accounts DataGrid -->
            <DataGrid Grid.Row="1"
                      x:Name="AccountsDataGrid"
                      ItemsSource="{Binding Accounts}"
                      SelectedItem="{Binding SelectedAccount, Mode=TwoWay}"
                      AutoGenerateColumns="False"
                      CanUserAddRows="False"
                      CanUserDeleteRows="False"
                      CanUserReorderColumns="False"
                      CanUserSortColumns="True"
                      IsReadOnly="True"
                      SelectionMode="Single"
                      GridLinesVisibility="Horizontal"
                      HeadersVisibility="Column"
                      Visibility="{Binding HasAccounts, Converter={StaticResource BoolToVisibilityConverter}}"
                      BorderThickness="1"
                      BorderBrush="{DynamicResource ControlElevationBorderBrush}">
                <DataGrid.Columns>
                    <!-- Status Indicator -->
                    <DataGridTemplateColumn Header="" Width="40">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <ui:SymbolIcon Symbol="CheckmarkCircle24" 
                                               FontSize="20"
                                               Foreground="#4CAF50"
                                               Visibility="{Binding IsActive, Converter={StaticResource BoolToVisibilityConverter}}"
                                               ToolTip="Active Account" />
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>

                    <!-- Avatar -->
                    <DataGridTemplateColumn Header="Avatar" Width="60">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <Border Width="40" Height="40" CornerRadius="20" Background="{DynamicResource ControlFillColorDefaultBrush}">
                                    <Image Source="{Binding AvatarThumbnailUrl}" Stretch="UniformToFill">
                                        <Image.Clip>
                                            <EllipseGeometry Center="20,20" RadiusX="20" RadiusY="20" />
                                        </Image.Clip>
                                    </Image>
                                </Border>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>

                    <!-- Display Name -->
                    <DataGridTemplateColumn Header="Display Name" Width="2*">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <StackPanel VerticalAlignment="Center">
                                    <TextBlock Text="{Binding DisplayName}" FontWeight="Medium" FontSize="14" />
                                    <TextBlock Text="{Binding Username, StringFormat='@{0}'}" 
                                               FontSize="12" 
                                               Foreground="{DynamicResource TextFillColorSecondaryBrush}" />
                                </StackPanel>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>

                    <!-- User ID -->
                    <DataGridTextColumn Header="User ID" Binding="{Binding UserId}" Width="*" />

                    <!-- Last Used -->
                    <DataGridTemplateColumn Header="Last Used" Width="*">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <TextBlock Text="{Binding LastUsed, StringFormat='{}{0:MM/dd/yyyy HH:mm}'}" 
                                           VerticalAlignment="Center" />
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>

                    <!-- Actions -->
                    <DataGridTemplateColumn Header="Actions" Width="180">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                                    <ui:Button Content="Switch" 
                                               Icon="ArrowSwap24"
                                               Margin="0,0,4,0"
                                               Appearance="Primary"
                                               Command="{Binding DataContext.SwitchAccountCommand, RelativeSource={RelativeSource AncestorType=DataGrid}}"
                                               CommandParameter="{Binding}"
                                               IsEnabled="{Binding IsActive, Converter={StaticResource InverseBoolConverter}}"
                                               ToolTip="Switch to this account" />
                                    <ui:Button Content="Remove" 
                                               Icon="Delete24"
                                               Appearance="Danger"
                                               Command="{Binding DataContext.RemoveAccountCommand, RelativeSource={RelativeSource AncestorType=DataGrid}}"
                                               CommandParameter="{Binding}"
                                               ToolTip="Remove this account" />
                                </StackPanel>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>
                </DataGrid.Columns>
            </DataGrid>

            <!-- Action Buttons -->
            <Grid Grid.Row="2" Margin="0,12,0,0">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>

                <ui:Button Grid.Column="0" 
                           Content="Add Account" 
                           Icon="PersonAdd24"
                           Appearance="Primary"
                           Margin="0,0,8,0"
                           Command="{Binding AddAccountCommand}" />

                <ui:Button Grid.Column="1" 
                           Content="Refresh Accounts" 
                           Icon="ArrowSync24"
                           Margin="0,0,8,0"
                           Command="{Binding RefreshAccountsCommand}"
                           IsEnabled="{Binding HasAccounts}" />

                <ui:Button Grid.Column="3" 
                           Content="Launch with Selected" 
                           Icon="Play24"
                           Appearance="Success"
                           Command="{Binding LaunchWithSelectedCommand}"
                           IsEnabled="{Binding IsAccountSelected}" />
            </Grid>
        </Grid>

        <!-- Security Warning -->
        <Border Margin="0,16,0,0" 
                BorderThickness="1" 
                BorderBrush="#FFA500"
                Background="#33FFA500"
                CornerRadius="4"
                Padding="12">
            <StackPanel>
                <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                    <ui:SymbolIcon Symbol="ShieldError24" FontSize="20" Foreground="#FFA500" Margin="0,0,8,0" />
                    <TextBlock Text="Security Notice" FontWeight="Bold" FontSize="14" Foreground="#FFA500" />
                </StackPanel>
                <TextBlock TextWrapping="Wrap" FontSize="13" Foreground="{DynamicResource TextFillColorPrimaryBrush}">
                    <Run Text="Your account security cookies are stored encrypted on your device. " />
                    <Run Text="Never share your .ROBLOSECURITY cookie with anyone. " FontWeight="Bold" />
                    <Run Text="Bloxstrap will never ask for your password." />
                </TextBlock>
            </StackPanel>
        </Border>

        <!-- Help Section -->
        <TextBlock Text="How to Add an Account" FontSize="20" FontWeight="Medium" Margin="0,24,0,8" />
        <Border BorderThickness="1" 
                BorderBrush="{DynamicResource ControlElevationBorderBrush}"
                Background="{DynamicResource ControlFillColorDefaultBrush}"
                CornerRadius="4"
                Padding="12">
            <StackPanel>
                

                <ui:Hyperlink Content="View detailed guide with screenshots" 
                              Margin="0,8,0,0"
                              NavigateUri="https://github.com/bloxstraplabs/bloxstrap/wiki/Account-Switching" />
            </StackPanel>
        </Border>
    </StackPanel>
</ui:UiPage>